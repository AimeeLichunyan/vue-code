{"version":3,"file":"vue.js","sources":["../../src/compiler/index.js","../../src/utils.js","../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["export function compileToFunctions(template) {\n    console.log(template)\n}","export function proxy(vm,data,key) {\n    Object.defineProperty(vm,key,{\n      get() {\n        return vm[data][key];\n      },\n      set(newValue) {\n        vm[data][key] = newValue\n      }\n    })\n  }\n  export function defineProperty(target,key,value) {\n    Object.defineProperty(target,key,{\n        enumerable:false, // 不能被，枚举，不能被循环出来\n        configurable:false,\n        value: value\n      })\n  }","// 拿到数组原型的方法（或者拿到数组原来的方法）\nlet oldArrayProtoMethods = Array.prototype;\n\n// 继承原来数组的方法 arrayMethods.__proto__ = oldArrayProtoMethods,继承以后可以重写，如果没有重写，则会顺着原型链找到原来数组的方法\nexport let arrayMethods = Object.create(oldArrayProtoMethods)\nlet methods = [\n    'push',\n    'pop',\n    'shift',\n    'unshift',\n    'reverse',\n    'sort',\n    'splice'\n]\n// 这是个高阶函数或者叫切片编程\nmethods.forEach(method => {\n    arrayMethods[method] = function(...args) { // this就是ob\n        const result = oldArrayProtoMethods[method].apply(this,arguments)\n        let inserted;\n        let ob = this.__ob__\n        switch (method) {\n            case 'push': // arr.push({a:1},{b:2})\n            case 'unshift': // push和unshift方法都是追加的,追加的内容可能是对象类型，应该再次进行劫持\n                inserted = args\n                break;\n            case 'splice': // vue.$set实现的原理就是splice，删除，添加，修改\n            inserted = args.slice(2) // arr.splice(0,1,{a:1})\n            default:\n                break;\n        }\n        if(inserted) ob.observeArray(inserted) // 给数组新增的值进行观测\n        return result\n    }\n})","import { defineProperty } from \"../utils\";\nimport { arrayMethods } from \"./array\";\n\n// 数据观测的方法\nclass Observer {\n  constructor(value) {\n    // 使用defineProperty重新定义属性，\n    // 判断一个对象是否被观测过，看它有没有__ob__这个属性\n    defineProperty(value,'__ob__',this)\n    \n    // 判断是否是数组\n    if(Array.isArray(value)) {\n      // 调用push，shift，unshift,splice,sort,reverse,pop等操作\n      // 函数劫持，或者切片编程\n      value.__proto__ = arrayMethods\n      // 观测数组中的对象类型，对象变化触发一些操作\n      this.observeArray(value)\n    }else {\n      //   使用defineProperty 重新定义属性\n    this.walk(value);\n    }\n    \n  }\n  observeArray(value) {\n    value.forEach(item => {\n      observe(item)\n    })\n  }\n  walk(data) {\n    let keys = Object.keys(data);\n    keys.forEach((key) => {\n      defineReactive(data, key, data[key]); // Vue.utils.defineReactive\n    });\n  }\n}\nfunction defineReactive(data, key, value) {// 为每一个对象添加defineProperty，getset函数，进行数据劫持\n  observe(value) // 递归进行检测，value是否是对象，只要对象层级比较深，就会不停的递归，影响性能，所以在vue3中使用proxy实现，vue3是懒递归\n  Object.defineProperty(data, key, { // 其实是一个闭包，当前作用域下data不销毁\n    get() {\n      console.log('q取值')\n      return value;\n    },\n    set(newValue) {\n      console.log('设置')\n      if (newValue == value) return; // 如果新值和老值一样则不赋值操作\n      observe(newValue) // 判断设置的新的值是不是对象，如果用户将值改为对象，则继续监控\n      value = newValue;\n    },\n  });\n}\nexport default function observe(data) {\n  if (typeof data !== \"object\" || data === null) {\n    return data;\n  }\n  if(data.__ob__) {\n    return data;\n  }\n  return new Observer(data);\n}\n","import observe from \"./observer/index.js\";\nimport { proxy } from \"./utils.js\";\n\n// 状态的初始化;\nexport function initSate(vm) {\n  // vue初始化的顺序就是：先初始化属性，在是方法，再是data\n  const opts = vm.$options;\n  if (opts.props) {\n    initProps(vm);\n  }\n  if (opts.methods) {\n    initMethods(vm);\n  }\n  //   核心部分\n  if (opts.data) {\n    initData(vm);\n  }\n  if (opts.computed) {\n    initComputed(vm);\n  }\n  if (opts.watch) {\n    initWatch(vm);\n  }\n}\nfunction initProps() {}\nfunction initMethods() {}\n\nfunction initData(vm) {\n  let data = vm.$options.data;\n  vm._data = data = typeof data == \"function\" ? data.call(vm) : data;\n  //   数据的劫持方案： 对象object.defineProperty\n  // 数组会单独处理\n\n  // 实现代理 -- 当我去vm上取值是，帮我将属性的取值代理大vm._data上\n  for(let key in data) {\n    proxy(vm,'_data',key)\n  }\n  observe(data);\n}\nfunction initComputed() {}\nfunction initWatch() {}\n","import { compileToFunctions } from \"./compiler/index\";\nimport { initSate } from \"./state\";\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    vm.$options = options;\n\n    // 初始化状态（数据做初始化劫持，改变数据时应该更新视图）\n    //  vue 组件中很多状态，data,props,watch,computed\n    initSate(vm);\n\n    // vue核心特性：响应式数据原理\n    // Vue 是什么框架，MVVM（不完全是）怎么是？ 数据变化视图会更新，视图变化数据会被影响，\n    // 怎么不是？ mvvm不能跳过数据直接更新视图，但是vue有$ref可以直接操作dom\n    // 如果有el属性，说明要渲染模板\n    if(vm.$options.el) {\n      vm.$mount(vm.$options.el)\n    }\n  };\n  Vue.prototype.$mount = function(el) {\n    // 挂载操作\n    const vm = this;\n    const options = vm.$options;\n\n    el = document.querySelector(el);\n    if(!options.render) {\n      // 没有render方法，将template转化成render方法\n      let template = options.template;\n      if(!template && el) { // 没有tamplatet，有el，直接采用外部模板，即我们平时的写法\n        template = el.outerHTML; // el.outerHTML拿到el所在的html元素\n      }\n      // 编译原理，将模板编译成render函数\n      const render = compileToFunctions(template); // 将dom结构编译成函数\n      options.render = render\n    }\n    console.log(options.render) // 渲染时用的都是这个render方法\n\n  }\n}\n","import { initMixin } from \"./init\";\nfunction Vue(options) {\n  console.log(options);\n  this._init(options);\n}\n//写成一个个的插件进行扩展，解耦方法\n// vue初始化方法\ninitMixin(Vue);\nexport default Vue;\n"],"names":["compileToFunctions","template","console","log","proxy","vm","data","key","Object","defineProperty","get","set","newValue","target","value","enumerable","configurable","oldArrayProtoMethods","Array","prototype","arrayMethods","create","methods","forEach","method","args","result","apply","arguments","inserted","ob","__ob__","slice","observeArray","Observer","isArray","__proto__","walk","item","observe","keys","defineReactive","initSate","opts","$options","props","initData","computed","watch","_data","call","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}